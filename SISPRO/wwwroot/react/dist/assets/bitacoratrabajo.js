import{r as i,j as e,B as F,R as E}from"./getAllowClear-DzOICv91.js";import{S as T,a as I}from"./index-Dq2T_yAH.js";import{D as P,R as v,d as Y}from"./FilterOutlined-BqIGPfms.js";import{F as k,u as C,w as O}from"./xlsx-BxSZtvm9.js";import{F as c}from"./index-Dz0cqGpm.js";import{D as M}from"./index-Btuqp7xZ.js";import{S as d}from"./LeftOutlined-DM8q5vvt.js";import{s as p}from"./index-BtLmpCpJ.js";import"./index-B8B8aVgb.js";import"./index-BdEWC5PL.js";import"./convertToTooltipProps-DsHUCvc1.js";const{RangePicker:A}=P,B=({onSearch:h,loading:m})=>{const[u]=c.useForm(),[f,w]=i.useState([]),[x,g]=i.useState([]),[j,b]=i.useState([]),[S,t]=i.useState(!1);i.useEffect(()=>{(async()=>{try{const r=await I.get("/Report/CargaFiltrosLista");if(r.data.Exito){const s=jQuery.parseJSON(r.data.LstProyectos),y=jQuery.parseJSON(r.data.LstUsuarios);w(s),b(y)}else setIsLoading(!1),p.error(data.Mensaje)}catch(r){p.error("Error al cargar proyectos"),console.error(r)}})()},[]);const o=async a=>{if(a.length===0){g([]);return}try{const r=await I.post("/Querys/CargaFiltroSprintLista",{LstProyectos:a}),s=jQuery.parseJSON(r.data.LstSprints);g(s)}catch(r){p.error("Error al cargar datos relacionados"),console.error(r)}},l=a=>{h(a),t(!1)},n=()=>{t(a=>!a)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{type:"default",shape:"circle",icon:e.jsx(v,{}),size:"large",onClick:n,style:{position:"fixed",top:50,right:16,zIndex:1e3}}),e.jsx(M,{title:"Filtros de Búsqueda",placement:"right",onClose:n,visible:S,width:400,children:e.jsx(c,{form:u,layout:"vertical",onFinish:l,children:e.jsxs(T,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsx(c.Item,{name:"dateRange",label:"Rango de Fechas",rules:[{required:!0,message:"El rango de fechas es obligatorio"}],children:e.jsx(A,{style:{width:"100%"}})}),e.jsx(c.Item,{name:"projects",label:"Proyectos",children:e.jsx(d,{mode:"multiple",placeholder:"Selecciona uno o varios proyectos",onChange:o,allowClear:!0,showSearch:!0,optionFilterProp:"children",filterOption:(a,r)=>{var s;return(s=r==null?void 0:r.children)==null?void 0:s.toLowerCase().includes(a.toLowerCase())},children:f.map(a=>e.jsx(d.Option,{value:a.IdCatalogo,children:a.DescLarga},a.IdCatalogo))})}),e.jsx(c.Item,{name:"sprints",label:"Sprints",children:e.jsx(d,{mode:"multiple",placeholder:"Selecciona uno o varios sprints",allowClear:!0,disabled:x.length===0,showSearch:!0,optionFilterProp:"children",filterOption:(a,r)=>{var s;return(s=r==null?void 0:r.children)==null?void 0:s.toLowerCase().includes(a.toLowerCase())},children:x.map(a=>e.jsx(d.Option,{value:a.IdCatalogo,children:a.DescLarga},a.IdCatalogo))})}),e.jsx(c.Item,{name:"collaborators",label:"Colaboradores",children:e.jsx(d,{mode:"multiple",placeholder:"Selecciona uno o varios colaboradores",allowClear:!0,disabled:j.length===0,showSearch:!0,optionFilterProp:"children",filterOption:(a,r)=>{var s,y,L,R,D;return(D=(R=(L=(y=(s=r==null?void 0:r.props)==null?void 0:s.children)==null?void 0:y.props)==null?void 0:L.children)==null?void 0:R[1])==null?void 0:D.toLowerCase().includes(a.toLowerCase())},children:j.map(a=>e.jsx(d.Option,{value:a.IdCatalogo,children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("img",{src:"http://app.yitpro.com/Archivos/Fotos/"+a.DescCorta+".jpg"||"./Archivos/Fotos/default.jpg",alt:a.DescCorta,style:{width:30,height:30,borderRadius:"50%",marginRight:10}}),a.DescLarga]})},a.IdCatalogo))})}),e.jsx(c.Item,{children:e.jsx(F,{type:"primary",htmlType:"submit",loading:m,block:!0,children:"Filtrar"})})]})})})]})},N=()=>{const[h,m]=i.useState(!1),[u,f]=i.useState([]),[w,x]=i.useState({projects:[],sprints:[],collaborators:[],dateRange:[null,null]}),g=[{title:"Recurso",dataIndex:"Nombre",key:"Nombre",onFilter:(t,o)=>o.Nombre.includes(t)},{title:"Fecha",dataIndex:"Fecha",key:"Fecha",render:t=>Y(t).format("YYYY-MM-DD"),onFilter:(t,o)=>o.Fecha.includes(t)},{title:"Horas Totales",dataIndex:"Horas",key:"Horas",render:t=>`${t} horas`},{title:"Total de Tareas",dataIndex:"Total",key:"Total"}],j=[{title:"Id",dataIndex:"IdActividadStr",key:"IdActividadStr",render:(t,o)=>e.jsxs("a",{href:"#",onClick:l=>{l.preventDefault(),clickalerta(o.IdActividad)},children:[t,"  "]})},{title:"Tarea",dataIndex:"Titulo",key:"Titulo"},{title:"Horas",dataIndex:"Tiempo",key:"Tiempo"},{title:"Comentario",dataIndex:"Comentario",key:"Comentario"}],b=async t=>{m(!0);try{x({projects:t.projects,sprints:t.sprints,collaborators:t.collaborators,dateRange:t.dateRange});const o={LstProyecto:t.projects,LstSprint:t.sprints,LstAsignado:t.collaborators,FechaSolIni:t.dateRange[0].format("YYYY-MM-DD"),FechaSolFin:t.dateRange[1].format("YYYY-MM-DD")},l=await I.post("/Report/ConsultaBitacoraTrabajo",o);l.data.Exito?f(jQuery.parseJSON(l.data.LstReporte)):p.error(l.data.Mensaje)}catch(o){console.error("Error al cargar tareas:",o),p.error("Hubo un error al cargar las tareas")}finally{m(!1)}},S=()=>{const t=u.map(n=>({Recurso:n.Nombre,Fecha:n.Fecha,"Horas Totales":n.Horas,"Total de Tareas":n.Total})),o=C.json_to_sheet(t),l=C.book_new();C.book_append_sheet(l,o,"Bitácora"),O(l,"bitacora_trabajo.xlsx")};return e.jsxs("div",{children:[e.jsx(B,{onSearch:b,loading:h}),e.jsx(T,{style:{marginBottom:16},children:e.jsx(F,{type:"default",onClick:S,loading:h,children:"Exportar a Excel"})}),e.jsx(k,{dataSource:u,columns:g,loading:h,expandable:{expandedRowRender:t=>e.jsx(k,{dataSource:t.LstActividades,columns:j,pagination:!1,rowKey:"IdKey"}),rowExpandable:t=>t.LstActividades&&t.LstActividades.length>0},rowKey:"IdKey"})]})},H=E.createRoot(document.getElementById("bitacoratrabajo"));H.render(e.jsx(N,{}));
